openapi: 3.0.3
info:
  title: HealthScope API
  version: 1.0.0
  description: >
    HealthScope REST API (WADe project). Provides condition search and condition
    details aggregated from Wikidata, DBpedia and WikiDoc. Educational only.
servers:
  - url: http://localhost:3000
    description: Local development server

tags:
  - name: Conditions
    description: Condition search and details

paths:
  /api/conditions/search:
    get:
      tags: [Conditions]
      summary: Search medical conditions
      description: >
        Searches for medical conditions by query string. Results come primarily from Wikidata.
        The order may be ranked to prefer entities with richer metadata.
      parameters:
        - in: query
          name: q
          required: true
          schema:
            type: string
            minLength: 2
          example: asthma
          description: Search query (minimum 2 characters)
      responses:
        "200":
          description: List of matching conditions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ConditionSearchItem"
              examples:
                example1:
                  value:
                    - id: Q35869
                      label: Asthma
                      description: Inflammatory disease of the airways of the lungs
                    - id: Q12204
                      label: Diabetes mellitus
                      description: Group of metabolic disorders characterized by hyperglycemia
        "400":
          description: Invalid query
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                tooShort:
                  value:
                    statusCode: 400
                    message: Query must be at least 2 characters.
                    error: Bad Request

  /api/conditions/{id}:
    get:
      tags: [Conditions]
      summary: Get condition details
      description: >
        Returns a normalized condition object including narrative overview (WikiDoc/DBpedia),
        structured sections, body systems and sources.
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            pattern: "^Q\\d+$"
          example: Q35869
          description: Wikidata entity id (Q-number)
      responses:
        "200":
          description: Condition details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConditionDetails"
              examples:
                example1:
                  value:
                    id: Q8054567
                    name: Yokkaichi asthma
                    description: Epidemic of asthma caused by air pollution in Japan
                    sections:
                      overview: null
                      symptoms: []
                      riskFactors: ["air pollution"]
                      prevention: []
                    bodySystems: []
                    sources:
                      - name: Wikidata
                        url: https://www.wikidata.org/wiki/Q8054567
                      - name: WikiDoc
                        url: https://www.wikidoc.org/index.php/
                      - name: DBpedia
                        url: http://dbpedia.org/resource/Yokkaichi_asthma
        "400":
          description: Invalid id format
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                badId:
                  value:
                    statusCode: 400
                    message: Invalid id. Expected something like Q35869.
                    error: Bad Request
        "404":
          description: Condition not found (optional)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/conditions/{id}/body:
    get:
      tags: [Conditions]
      summary: Get body systems impacted by condition
      description: Returns body systems/anatomical context (best effort; may be empty for sparse entities).
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            pattern: "^Q\\d+$"
          example: Q41861
      responses:
        "200":
          description: Body impact
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BodyImpactResponse"
              examples:
                example1:
                  value:
                    id: Q41861
                    bodySystems:
                      - id: Q7366
                        label: cardiovascular system
        "400":
          description: Invalid id
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/conditions/{id}/geo:
    get:
      tags: [Conditions]
      summary: Get geographic context (proxy)
      description: >
        Returns an educational proxy "risk context" for a condition in a given country.
        Not epidemiology; intended for demonstration and UI explanations.
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            pattern: "^Q\\d+$"
          example: Q12204
        - in: query
          name: country
          required: true
          schema:
            type: string
            minLength: 2
            maxLength: 2
          example: RO
          description: ISO 3166-1 alpha-2 country code
      responses:
        "200":
          description: Geographic context proxy response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GeoContextResponse"
              examples:
                example1:
                  value:
                    id: Q12204
                    country: RO
                    value: 0.6
                    valueLabel: Estimated risk context (proxy)
                    factors:
                      - Climate
                      - Population density
                      - Industrial exposure
                      - Lifestyle/diet
                    sources:
                      - name: Educational proxy
                        url: null
        "400":
          description: Invalid request (missing country, invalid id, etc.)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

components:
  schemas:
    ConditionSearchItem:
      type: object
      additionalProperties: false
      required: [id, label]
      properties:
        id:
          type: string
          description: Wikidata entity id
          example: Q35869
        label:
          type: string
          example: Asthma
        description:
          type: string
          nullable: true
          example: Inflammatory disease of the airways of the lungs

    SourceLink:
      type: object
      additionalProperties: false
      required: [name, url]
      properties:
        name:
          type: string
          example: Wikidata
        url:
          type: string
          nullable: true
          example: https://www.wikidata.org/wiki/Q35869

    Sections:
      type: object
      additionalProperties: false
      required: [overview, symptoms, riskFactors, prevention]
      properties:
        overview:
          type: string
          nullable: true
          description: Narrative overview (WikiDoc/DBpedia), best-effort
        symptoms:
          type: array
          items:
            type: string
        riskFactors:
          type: array
          items:
            type: string
        prevention:
          type: array
          items:
            type: string

    BodySystem:
      type: object
      additionalProperties: false
      required: [id, label]
      properties:
        id:
          type: string
          description: Wikidata id (preferred) or identifier
          example: Q7366
        label:
          type: string
          example: cardiovascular system

    ConditionDetails:
      type: object
      additionalProperties: false
      required: [id, name, description, sections, bodySystems, sources]
      properties:
        id:
          type: string
          example: Q41861
        name:
          type: string
          example: Hypertension
        description:
          type: string
          nullable: true
          example: High blood pressure
        sections:
          $ref: "#/components/schemas/Sections"
        bodySystems:
          type: array
          items:
            $ref: "#/components/schemas/BodySystem"
        sources:
          type: array
          items:
            $ref: "#/components/schemas/SourceLink"

    BodyImpactResponse:
      type: object
      additionalProperties: false
      required: [id, bodySystems]
      properties:
        id:
          type: string
          example: Q35869
        bodySystems:
          type: array
          items:
            $ref: "#/components/schemas/BodySystem"

    GeoSource:
      type: object
      additionalProperties: false
      required: [name, url]
      properties:
        name:
          type: string
          example: Educational proxy
        url:
          type: string
          nullable: true

    GeoContextResponse:
      type: object
      additionalProperties: false
      required: [id, country, value, valueLabel, factors, sources]
      properties:
        id:
          type: string
          example: Q12204
        country:
          type: string
          example: RO
        value:
          type: number
          format: float
          example: 0.6
        valueLabel:
          type: string
          example: Estimated risk context (proxy)
        factors:
          type: array
          items:
            type: string
        sources:
          type: array
          items:
            $ref: "#/components/schemas/GeoSource"

    ErrorResponse:
      type: object
      additionalProperties: true
      required: [statusCode, message, error]
      properties:
        statusCode:
          type: integer
          example: 400
        message:
          oneOf:
            - type: string
            - type: array
              items:
                type: string
        error:
          type: string
          example: Bad Request
